<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema Oficina Completo</title>
  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --txt:#1f2937;
      --muted:#6b7280;
      --pri:#2563eb;
      --pri-600:#1d4ed8;
      --bd:#e5e7eb;
      --ok:#16a34a;
      --err:#dc2626;
      --tab:#111827;
    }
    *{box-sizing:border-box;}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      color:var(--txt);
      background:var(--bg);
    }

    /* Tabs */
    .tabs{
      display:flex;
      gap:.75rem;
      padding:1rem;
      position:sticky;
      top:0;
      z-index:2;
      background:linear-gradient(#fff,rgba(255,255,255,.8),transparent);
      backdrop-filter:saturate(1.2) blur(8px);
      border-bottom:1px solid var(--bd);
    }
    .tab-btn{
      flex:1 1 0;
      background:#fff;
      color:#111827;
      border:1px solid var(--bd);
      border-radius:.75rem;
      height:3rem;
      font-weight:600;
      letter-spacing:.02em;
      cursor:pointer;
      transition:.15s ease;
    }
    .tab-btn:hover{transform:translateY(-1px)}
    .tab-btn.active{
      background:var(--tab);
      color:#fff;
      border-color:transparent;
    }

    /* Container */
    .section{display:none; padding:1rem; max-width:1200px; margin:0 auto;}
    .section.active{display:block;}
    .card{
      background:var(--card);
      border:1px solid var(--bd);
      border-radius:1rem;
      padding:1.25rem;
      box-shadow:0 6px 20px rgba(0,0,0,.04);
    }
    h2{margin:0 0 .75rem 0; font-size:1.25rem}

    /* Form */
    form{display:grid; gap:1rem}
    .grid{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap: .75rem 1rem;
    }
    .col-6{grid-column:span 6}
    .col-12{grid-column:span 12}
    @media (max-width:900px){
      .col-6{grid-column:span 12}
    }

    label{
      font-size:.85rem;
      color:var(--muted);
      display:block;
      margin:0 0 .35rem 2px;
    }
    input, textarea{
      width:100%;
      height:44px;
      padding:.65rem .8rem;
      border:1px solid var(--bd);
      border-radius:.6rem;
      background:#fff;
      color:var(--txt);
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    textarea{min-height:110px; resize:vertical}
    input:focus, textarea:focus{
      border-color:var(--pri);
      box-shadow:0 0 0 3px rgb(37 99 235 / 14%);
    }

    .actions{display:flex; gap:.75rem; align-items:center}
    .btn{
      height:44px; padding:0 1rem; border-radius:.6rem;
      border:1px solid transparent; font-weight:600; cursor:pointer;
    }
    .btn-primary{background:var(--pri); color:#fff}
    .btn-primary:hover{background:var(--pri-600)}
    .btn-ghost{background:#fff; border-color:var(--bd)}
    .msg{
      font-size:.9rem;
      display:none;
      padding:.6rem .8rem;
      border-radius:.6rem;
    }
    .msg.ok{display:block; color:#065f46; background:#d1fae5; border:1px solid #10b981}
    .msg.err{display:block; color:#7f1d1d; background:#fee2e2; border:1px solid #ef4444}
  </style>
</head>
<body>
  <!-- TABS -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="entrada">ENTRADA</button>
    <button class="tab-btn" data-tab="aguardando">AGUARDANDO</button>
    <button class="tab-btn" data-tab="emandamento">EM ANDAMENTO</button>
    <button class="tab-btn" data-tab="finalizado">FINALIZADO</button>
  </div>

  <!-- ENTRADA -->
  <section id="entrada" class="section active">
    <div class="card">
      <h2>Cadastro de Serviço</h2>

      <form id="cadastroForm">
        <div class="grid">
          <!-- 1) DATA E HORA / NOME / CPF -->
          <div class="col-6">
            <label for="DATA_E_HORA">DATA E HORA</label>
            <input type="datetime-local" id="DATA_E_HORA" name="DATA E HORA" required />
          </div>
          <div class="col-6">
            <label for="NOME">NOME</label>
            <input type="text" id="NOME" name="NOME" required />
          </div>
          <div class="col-6">
            <label for="CPF">CPF</label>
            <input type="text" id="CPF" name="CPF" />
          </div>

          <!-- 2) TELEFONE / ENDEREÇO / NÚMERO -->
          <div class="col-6">
            <label for="TELEFONE">TELEFONE</label>
            <input type="text" id="TELEFONE" name="TELEFONE" />
          </div>
          <div class="col-6">
            <label for="ENDERECO">ENDEREÇO</label>
            <input type="text" id="ENDERECO" name="ENDEREÇO" />
          </div>
          <div class="col-6">
            <label for="NUMERO">NÚMERO</label>
            <input type="text" id="NUMERO" name="NÚMERO" />
          </div>

          <!-- 3) BAIRRO / CIDADE / UF -->
          <div class="col-6">
            <label for="BAIRRO">BAIRRO</label>
            <input type="text" id="BAIRRO" name="BAIRRO" />
          </div>
          <div class="col-6">
            <label for="CIDADE">CIDADE</label>
            <input type="text" id="CIDADE" name="CIDADE" />
          </div>
          <div class="col-6">
            <label for="UF">UF</label>
            <input type="text" id="UF" name="UF" />
          </div>

          <!-- 4) VEÍCULO / KM INICIAL / PLACA -->
          <div class="col-6">
            <label for="VEICULO">VEÍCULO</label>
            <input type="text" id="VEICULO" name="VEÍCULO" />
          </div>
          <div class="col-6">
            <label for="KM_INICIAL">KM INICIAL</label>
            <input type="text" id="KM_INICIAL" name="KM INICIAL" />
          </div>
          <div class="col-6">
            <label for="PLACA">PLACA</label>
            <input type="text" id="PLACA" name="PLACA" />
          </div>

          <!-- 5) ANO / MOTOR / MODELO -->
          <div class="col-6">
            <label for="ANO">ANO</label>
            <input type="text" id="ANO" name="ANO" />
          </div>
          <div class="col-6">
            <label for="MOTOR">MOTOR</label>
            <input type="text" id="MOTOR" name="MOTOR" />
          </div>
          <div class="col-6">
            <label for="MODELO">MODELO</label>
            <input type="text" id="MODELO" name="MODELO" />
          </div>

          <!-- 6) PROBLEMA APONTADO / KM FINAL -->
          <div class="col-12">
            <label for="PROBLEMA_APONTADO">PROBLEMA APONTADO</label>
            <input type="text" id="PROBLEMA_APONTADO" name="PROBLEMA APONTADO" />
          </div>
          <div class="col-6">
            <label for="KM_FINAL">KM FINAL</label>
            <input type="text" id="KM_FINAL" name="KM FINAL" />
          </div>

          <!-- 7) OBSERVAÇÕES / COTAÇÃO -->
          <div class="col-12">
            <label for="OBSERVACOES">OBSERVAÇÕES</label>
            <textarea id="OBSERVACOES" name="OBSERVAÇÕES" placeholder="Observações gerais..."></textarea>
          </div>
          <div class="col-12">
            <label for="COTACAO">COTAÇÃO</label>
            <textarea id="COTACAO" name="COTAÇÃO" placeholder="Itens, valores, mão de obra..."></textarea>
          </div>
        </div>

        <div class="actions">
          <button type="submit" id="btnEnviar" class="btn btn-primary">Enviar</button>
          <button type="reset" class="btn btn-ghost">Limpar</button>
          <span id="statusOk"  class="msg ok">Dados enviados com sucesso!</span>
          <span id="statusErr" class="msg err">Erro ao enviar. Tente novamente.</span>
        </div>
      </form>
    </div>
  </section>

  <!-- demais abas ainda vazias -->
  <section id="aguardando"  class="section"><div class="card"><h2>Serviços Aguardando</h2><p>Aqui você pode listar futuramente os serviços em fila.</p></div></section>
  <section id="emandamento" class="section"><div class="card"><h2>Serviços em Andamento</h2><p>Em breve: carregar dados da planilha e editar cotações.</p></div></section>
  <section id="finalizado"   class="section"><div class="card"><h2>Serviços Finalizados</h2><p>Em breve.</p></div></section>

  <script>
    // 1) Troca de abas
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
      });
    });

    // 2) Preencher DATA E HORA automaticamente
    function toLocalDatetimeValue(date){
      // datetime-local exige: YYYY-MM-DDTHH:MM (sem timezone)
      const pad = n => String(n).padStart(2,'0');
      const y = date.getFullYear();
      const m = pad(date.getMonth()+1);
      const d = pad(date.getDate());
      const hh = pad(date.getHours());
      const mm = pad(date.getMinutes());
      return `${y}-${m}-${d}T${hh}:${mm}`;
    }
    document.addEventListener('DOMContentLoaded', ()=>{
      const dt = document.getElementById('DATA_E_HORA');
      if (dt && !dt.value) dt.value = toLocalDatetimeValue(new Date());
    });

    // 3) Envio para o Apps Script
    const scriptURL = 'COLE_AQUI_O_SEU_URL_DO_WEB_APP_DO_APPS_SCRIPT'; // <-- troque pelo seu /exec

    const form = document.getElementById('cadastroForm');
    const btnEnviar = document.getElementById('btnEnviar');
    const ok  = document.getElementById('statusOk');
    const err = document.getElementById('statusErr');

    // helper: normalizar chave (sem acentos, sem espaços)
    const normalizeKey = (s) => s
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // remove acentos
      .replace(/\s+/g,'') // remove espaços
      .replace(/[^\w]/g,''); // remove outros símbolos

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      ok.style.display = 'none';
      err.style.display = 'none';

      btnEnviar.disabled = true;
      btnEnviar.textContent = 'Enviando...';

      try{
        // Monta objeto com e sem acento (para compatibilizar com diferentes scripts)
        const fd = new FormData(form);
        const obj = {};
        fd.forEach((value, key)=>{
          obj[key] = value; // chave original (com acento/espacos)
          obj[ normalizeKey(key) ] = value; // chave normalizada (sem acento/espacos)
        });

        const resp = await fetch(scriptURL, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(obj)
        });

        // se seu Apps Script retorna texto "OK", ainda assim só vamos mostrar sucesso
        if (!resp.ok) throw new Error('Falha HTTP');

        ok.style.display = 'inline-block';
        form.reset();
        // repõe a data/hora atual após reset
        const dt = document.getElementById('DATA_E_HORA');
        if (dt) dt.value = toLocalDatetimeValue(new Date());
      }catch(ex){
        console.error(ex);
        err.style.display = 'inline-block';
      }finally{
        btnEnviar.disabled = false;
        btnEnviar.textContent = 'Enviar';
      }
    });
  </script>
</body>
</html>
