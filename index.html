<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Sistema Oficina Completo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
    }
    .tabs {
      display: flex;
      background-color: #007bff;
    }
    .tab {
      flex: 1;
      padding: 10px;
      color: white;
      text-align: center;
      cursor: pointer;
    }
    .tab:hover {
      background-color: #0056b3;
    }
    .active {
      background-color: #0056b3;
    }
    .content {
      padding: 20px;
    }
    input, textarea, button {
      display: block;
      margin: 10px 0;
      width: 100%;
      padding: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: left;
    }
    button.acao {
      padding: 4px 8px;
      margin: 2px;
    }
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active" onclick="trocarAba('entrada')">Entrada</div>
    <div class="tab" onclick="trocarAba('aguardando')">Aguardando</div>
    <div class="tab" onclick="trocarAba('emandamento')">Em Andamento</div>
    <div class="tab" onclick="trocarAba('finalizado')">Finalizado</div>
  </div>

  <div class="content" id="conteudo"></div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxQIh9n0rqefzWoLTWPGqG6HWKzEeHhYhjkuqzsUUvXtnW21BVkdf_BZM3nbZKOXsC1Ug/exec'; // SUBSTITUA AQUI PELO SEU LINK DO WEB APP
    const planilhaID = '1H9MdkeXFNuT8AKYbCKEOpj1LxpELtsdVvxOhLWXXhJ0';

    function trocarAba(aba) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`.tab[onclick*="${aba}"]`).classList.add('active');
      carregarConteudo(aba);
    }

    function carregarConteudo(aba) {
      const abaUpper = aba.toUpperCase();
      const conteudo = document.getElementById('conteudo');

      if (aba === 'entrada') {
        conteudo.innerHTML = `
          <h2>Formulário de Entrada</h2>
          <form id="formulario">
            <input name="DATA E HORA" placeholder="Data e Hora" required>
            <input name="NOME" placeholder="Nome" required>
            <input name="CPF" placeholder="CPF">
            <input name="TELEFONE" placeholder="Telefone">
            <input name="ENDEREÇO" placeholder="Endereço">
            <input name="NÚMERO" placeholder="Número">
            <input name="BAIRRO" placeholder="Bairro">
            <input name="CIDADE" placeholder="Cidade">
            <input name="UF" placeholder="UF">
            <input name="VEÍCULO" placeholder="Veículo">
            <input name="KM INICIAL" placeholder="KM Inicial">
            <input name="PLACA" placeholder="Placa">
            <input name="ANO" placeholder="Ano">
            <input name="MOTOR" placeholder="Motor">
            <input name="MODELO" placeholder="Modelo">
            <input name="PROBLEMA APONTADO" placeholder="Problema Apontado">
            <input name="KM FINAL" placeholder="KM Final">
            <textarea name="OBSERVAÇÕES" placeholder="Observações"></textarea>
            <textarea name="COTAÇÃO" placeholder="Cotação"></textarea>
            <button type="submit">Enviar</button>
          </form>
        `;
        document.getElementById('formulario').addEventListener('submit', enviarFormulario);
      } else {
        conteudo.innerHTML = `<h2>${capitalize(aba)}</h2><div id="tabelaDados">Carregando...</div>`;
        fetch(`https://opensheet.elk.sh/${planilhaID}/${abaUpper}`)
          .then(res => res.json())
          .then(dados => {
            if (!dados.length) {
              document.getElementById('tabelaDados').innerHTML = 'Sem dados.';
              return;
            }

            let tabela = `<table><thead><tr>`;
            Object.keys(dados[0]).forEach(coluna => {
              tabela += `<th>${coluna}</th>`;
            });
            tabela += `<th>Ações</th></tr></thead><tbody>`;
            dados.forEach((linha, i) => {
              tabela += `<tr>`;
              Object.values(linha).forEach(celula => {
                tabela += `<td>${celula}</td>`;
              });

              tabela += `<td>`;
              if (aba === 'aguardando') {
                tabela += `<button class="acao" onclick="mover(${i}, '${aba}', 'EM ANDAMENTO')">Mover para Em Andamento</button>`;
              } else if (aba === 'emandamento') {
                tabela += `<button class="acao" onclick="mover(${i}, '${aba}', 'FINALIZADO')">Finalizar</button>`;
                tabela += `<button class="acao" onclick="mover(${i}, '${aba}', 'AGUARDANDO')">Voltar</button>`;
              } else if (aba === 'finalizado') {
                tabela += `<button class="acao" onclick="mover(${i}, '${aba}', 'EM ANDAMENTO')">Voltar</button>`;
              }
              tabela += `</td></tr>`;
            });
            tabela += `</tbody></table>`;
            document.getElementById('tabelaDados').innerHTML = tabela;
          })
          .catch(() => {
            document.getElementById('tabelaDados').innerHTML = 'Erro ao carregar os dados.';
          });
      }
    }

    function enviarFormulario(e) {
      e.preventDefault();
      const dados = new FormData(e.target);
      fetch(`${scriptURL}?aba=AGUARDANDO`, {
        method: 'POST',
        body: dados
      }).then(res => {
        alert('Enviado com sucesso!');
        e.target.reset();
      }).catch(() => alert('Erro ao enviar.'));
    }

    function mover(index, origem, destino) {
      fetch(`https://opensheet.elk.sh/${planilhaID}/${origem.toUpperCase()}`)
        .then(res => res.json())
        .then(dados => {
          const linha = dados[index];
          const formData = new FormData();
          Object.keys(linha).forEach(key => {
            formData.append(key, linha[key]);
          });

          fetch(`${scriptURL}?aba=${destino}`, {
            method: 'POST',
            body: formData
          }).then(() => {
            alert(`Movido para ${destino} com sucesso.`);
            carregarConteudo(origem.toLowerCase());
          }).catch(() => alert('Erro ao mover.'));
        });
    }

    function capitalize(texto) {
      return texto.charAt(0).toUpperCase() + texto.slice(1);
    }

    trocarAba('entrada');
  </script>
</body>
</html>
