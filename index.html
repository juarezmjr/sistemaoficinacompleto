
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema Oficina Completo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f9f9f9;
    }

    .tabs {
      display: flex;
      background-color: #1a73e8;
    }

    .tab-button {
      flex: 1;
      padding: 15px;
      cursor: pointer;
      background-color: #1a73e8;
      color: white;
      border: none;
      outline: none;
      transition: background 0.3s;
    }

    .tab-button.active {
      background-color: #0c47a1;
    }

    .tab-content {
      display: none;
      padding: 20px;
    }

    .tab-content.active {
      display: block;
    }

    .form-field {
      margin-bottom: 10px;
    }

    .form-field input, .form-field textarea {
      width: 100%;
      padding: 10px;
      font-size: 14px;
    }

    .success {
      color: green;
      margin-top: 10px;
    }

    .record {
      background: #fff;
      padding: 10px;
      margin-bottom: 8px;
      border: 1px solid #ccc;
    }

    .btn-acao {
      margin-top: 5px;
    }
  </style>
</head>
<body>

  <div class="tabs">
    <button class="tab-button active" onclick="openTab(event, 'entrada')">Entrada</button>
    <button class="tab-button" onclick="openTab(event, 'aguardando')">Aguardando</button>
    <button class="tab-button" onclick="openTab(event, 'emandamento')">Em Andamento</button>
    <button class="tab-button" onclick="openTab(event, 'finalizado')">Finalizado</button>
  </div>

  <div id="entrada" class="tab-content active">
    <h2>Formulário de Entrada</h2>
    <form id="formulario">
      <div class="form-field"><input type="text" name="DATA E HORA" placeholder="Data e Hora" required /></div>
      <div class="form-field"><input type="text" name="NOME" placeholder="Nome" required /></div>
      <div class="form-field"><input type="text" name="CPF" placeholder="CPF" required /></div>
      <div class="form-field"><input type="text" name="TELEFONE" placeholder="Telefone" required /></div>
      <div class="form-field"><input type="text" name="ENDEREÇO" placeholder="Endereço" /></div>
      <div class="form-field"><input type="text" name="NÚMERO" placeholder="Número" /></div>
      <div class="form-field"><input type="text" name="BAIRRO" placeholder="Bairro" /></div>
      <div class="form-field"><input type="text" name="CIDADE" placeholder="Cidade" /></div>
      <div class="form-field"><input type="text" name="UF" placeholder="UF" /></div>
      <div class="form-field"><input type="text" name="VEÍCULO" placeholder="Veículo" /></div>
      <div class="form-field"><input type="text" name="KM INICIAL" placeholder="KM Inicial" /></div>
      <div class="form-field"><input type="text" name="PLACA" placeholder="Placa" /></div>
      <div class="form-field"><input type="text" name="ANO" placeholder="Ano" /></div>
      <div class="form-field"><input type="text" name="MOTOR" placeholder="Motor" /></div>
      <div class="form-field"><input type="text" name="MODELO" placeholder="Modelo" /></div>
      <div class="form-field"><input type="text" name="PROBLEMA APONTADO" placeholder="Problema Apontado" /></div>
      <div class="form-field"><input type="text" name="KM FINAL" placeholder="KM Final" /></div>
      <div class="form-field"><input type="text" name="OBSERVAÇÕES" placeholder="Observações" /></div>
      <div class="form-field"><textarea name="COTAÇÃO" placeholder="Itens, valores, mão de obra..."></textarea></div>
      <button type="submit">Enviar</button>
      <button type="reset">Limpar</button>
      <div id="mensagem" class="success"></div>
    </form>
  </div>

  <div id="aguardando" class="tab-content">
    <h2>Registros Aguardando</h2>
    <div id="tabela-aguardando"></div>
  </div>

  <div id="emandamento" class="tab-content">
    <h2>Registros em Andamento</h2>
    <div id="tabela-emandamento"></div>
  </div>

  <div id="finalizado" class="tab-content">
    <h2>Registros Finalizados</h2>
    <div id="tabela-finalizado"></div>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwsc5_8uZVMoIrNB4jbyIpAa1NbUslHJKHNeU_sNI0e3Ddtrmrt0IXbumn8LjjUzca1BA/exec';
    const planilhaID = '1H9MdkeXFNuT8AKYbCKEOpj1LxpELtSdVvxOhLWxXhJ0';

    const form = document.getElementById('formulario');
    const mensagem = document.getElementById('mensagem');

    form.addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(form);
      fetch(scriptURL + '?aba=AGUARDANDO', { method: 'POST', body: formData })
        .then(() => {
          mensagem.textContent = "Dados enviados com sucesso!";
          form.reset();
        })
        .catch(error => {
          mensagem.textContent = "Erro ao enviar dados!";
          console.error('Erro:', error);
        });
    });

    function openTab(evt, tabName) {
      const tabcontent = document.getElementsByClassName("tab-content");
      for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
      }

      const tablinks = document.getElementsByClassName("tab-button");
      for (let i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
      }

      document.getElementById(tabName).classList.add("active");
      evt.currentTarget.classList.add("active");

      if (tabName !== 'entrada') {
        carregarDados(tabName);
      }
    }

    function carregarDados(aba) {
      const container = document.getElementById(`tabela-${aba}`);
      container.innerHTML = 'Carregando...';

      const nomeAba = aba.toUpperCase().replace("EMANDAMENTO", "EM ANDAMENTO");
      const url = `https://opensheet.elk.sh/${planilhaID}/${nomeAba}`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (!data.length) {
            container.innerHTML = 'Nenhum registro encontrado.';
            return;
          }

          container.innerHTML = '';
          data.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'record';
            div.innerHTML = `
              <strong>${item['NOME'] || 'Sem nome'}</strong><br/>
              Veículo: ${item['VEÍCULO'] || ''} | Placa: ${item['PLACA'] || ''}<br/>
              Serviço: ${item['PROBLEMA APONTADO'] || ''}<br/>
              Cotação: ${item['COTAÇÃO'] || ''}<br/>
              ${aba === 'aguardando' ? `<button class="btn-acao" onclick="mover('${nomeAba}', ${index})">Mover para Em Andamento</button>` : ''}
              ${aba === 'emandamento' ? `
                <button class="btn-acao" onclick="mover('${nomeAba}', ${index})">Finalizar</button>
                <button class="btn-acao" onclick="voltar('${nomeAba}', ${index})">Voltar</button>` : ''}
            `;
            container.appendChild(div);
          });
        });
    }

    function mover(origem, index) {
      const destino = origem === 'AGUARDANDO' ? 'EM ANDAMENTO' :
                      origem === 'EM ANDAMENTO' ? 'FINALIZADO' : '';
      if (!destino) return;

      fetch(`https://opensheet.elk.sh/${planilhaID}/${origem}`)
        .then(res => res.json())
        .then(data => {
          const linha = data[index];
          const formData = new FormData();
          Object.keys(linha).forEach(key => {
            formData.append(key, linha[key]);
          });

          fetch(scriptURL + '?aba=' + destino, {
            method: 'POST',
            body: formData
          }).then(() => {
            alert(`Movido para ${destino} com sucesso.`);
            carregarDados(origem.toLowerCase().replace("EM ANDAMENTO", "emandamento"));
          });
        });
    }

    function voltar(origem, index) {
      const destino = origem === 'FINALIZADO' ? 'EM ANDAMENTO' :
                      origem === 'EM ANDAMENTO' ? 'AGUARDANDO' : '';
      if (!destino) return;

      fetch(`https://opensheet.elk.sh/${planilhaID}/${origem}`)
        .then(res => res.json())
        .then(data => {
          const linha = data[index];
          const formData = new FormData();
          Object.keys(linha).forEach(key => {
            formData.append(key, linha[key]);
          });

          fetch(scriptURL + '?aba=' + destino, {
            method: 'POST',
            body: formData
          }).then(() => {
            alert(`Movido para ${destino} com sucesso.`);
            carregarDados(origem.toLowerCase().replace("EM ANDAMENTO", "emandamento"));
          });
        });
    }
  </script>

</body>
</html>
